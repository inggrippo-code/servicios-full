<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador Inteligente - Servicios Full</title>
    <style>
        body { 
            background-color: #f4f7f6; 
            color: #333; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Fondo con fotos vivas (Sutil) */
        .bg-viva {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1581578731522-a20478d4486b?auto=format&fit=crop&q=80&w=2070');
            background-size: cover;
            opacity: 0.07;
            z-index: -1;
        }

        .mini-seguridad {
            background: #ffffff;
            color: #00a884;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 11px;
            margin-top: 15px;
            border: 1px solid #00a884;
            font-weight: bold;
        }

        .search-box {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            width: 90%; max-width: 450px;
            margin-top: 20px;
            border: 1px solid #eee;
            z-index: 10;
        }

        input {
            width: 90%; padding: 12px; margin: 8px 0;
            border: 1px solid #ddd; border-radius: 10px; font-size: 16px;
        }

        /* MOSAICO DE SERVICIOS (VITRINA) */
        .vitrina-servicios {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            width: 95%;
            max-width: 1000px;
        }

        .card-servicio {
            width: 140px;
            height: 180px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid #eee;
            position: relative;
        }

        .card-servicio:hover { transform: translateY(-5px); border-color: #ff6600; }

        .card-servicio img { width: 100%; height: 100px; object-fit: cover; }

        .card-servicio span {
            display: block;
            padding: 10px;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            color: #333;
        }

        /* RESULTADOS FINALES */
        #resultados { margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }

        .tarjeta-experto {
            background: white; padding: 20px; border-radius: 15px; width: 280px;
            border-left: 5px solid #ff6600; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: left;
        }
    </style>
</head>
<body>

    <div class="bg-viva"></div>

    <div class="mini-seguridad">üõ°Ô∏è PAGO SEGURO INTERMEDIADO</div>

    <h1 style="font-weight: 300;">Servicios en <span style="color:#ff6600; font-weight:bold;">Tu Ciudad</span></h1>

    <div class="search-box">
        <input type="text" id="ciudad" placeholder="üìç Escribe tu ciudad (ej: Posadas)" oninput="mostrarVitrina()">
        <input type="text" id="oficio" placeholder="üõ†Ô∏è ¬øQu√© servicio buscas?">
    </div>

    <div id="vitrina" class="vitrina-servicios"></div>

    <div id="resultados"></div>

    <script>
        // Simulamos fotos por categor√≠a para el impacto visual
        const fotosSugeridas = {
            "plomero": "https://images.unsplash.com/photo-1581244276891-8339386d3331?q=80&w=200",
            "electricista": "https://images.unsplash.com/photo-1621905251189-08b45d6a269e?q=80&w=200",
            "enfermera": "https://images.unsplash.com/photo-1576765608535-5f04d1e3f289?q=80&w=200",
            "flete": "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?q=80&w=200",
            "default": "https://images.unsplash.com/photo-1581578731522-a20478d4486b?q=80&w=200"
        };

        async function mostrarVitrina() {
            const ciudad = document.getElementById('ciudad').value.toLowerCase();
            const vitrina = document.getElementById('vitrina');
            const resultados = document.getElementById('resultados');
            
            if (ciudad.length < 3) {
                vitrina.innerHTML = "";
                return;
            }

            const res = await fetch('/usuarios-datos');
            const datos = await res.json();

            // Buscamos oficios √∫nicos en esa ciudad
            const oficiosEnCiudad = [...new Set(datos
                .filter(p => p.ciudad.toLowerCase().includes(ciudad))
                .map(p => p.servicio.toLowerCase())
            )];

            vitrina.innerHTML = "";
            resultados.innerHTML = "";

            oficiosEnCiudad.forEach(oficio => {
                const foto = fotosSugeridas[oficio] || fotosSugeridas["default"];
                vitrina.innerHTML += `
                    <div class="card-servicio" onclick="buscarEspecifico('${oficio}')">
                        <img src="${foto}" alt="${oficio}">
                        <span>${oficio.toUpperCase()}</span>
                    </div>
                `;
            });
        }

        async function buscarEspecifico(oficio) {
            const ciudad = document.getElementById('ciudad').value.toLowerCase();
            const res = await fetch('/usuarios-datos');
            const datos = await res.json();

            const filtrados = datos.filter(p => 
                p.ciudad.toLowerCase().includes(ciudad) && 
                p.servicio.toLowerCase() === oficio
            );

            const div = document.getElementById('resultados');
            div.innerHTML = "";
            document.getElementById('vitrina').innerHTML = ""; // Limpiamos vitrina para mostrar resultados

            filtrados.forEach(p => {
                div.innerHTML += `
                    <div class="tarjeta-experto">
                        <small style="color:#00a884; font-weight:bold;">‚óè VERIFICADO</small>
                        <h3>${p.nombre}</h3>
                        <p>üìç ${p.ciudad} | ‚≠ê ${p.calificacion}</p>
                        <button style="width:100%; padding:10px; background:#00a884; color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer;" onclick="alert('Solicitando presupuesto seguro...')">SOLICITAR SERVICIO</button>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
